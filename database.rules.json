{
  "rules": {
    ".read": "auth != null",
    ".write": "auth != null",

    "rooms": {
      "$roomCode": {
        ".read": true,
        ".write": "auth != null && (!data.exists() || root.child('rooms').child($roomCode).child('host').val() == auth.uid || (newData.child('host').exists() && !newData.child('settings').exists() && !newData.child('status').exists()))",

        "players": {
          "$playerId": {
            ".write": "auth.uid == $playerId || root.child('rooms').child($roomCode).child('host').val() == auth.uid"
          }
        },

        "settings": {
          ".write": "root.child('rooms').child($roomCode).child('host').val() == auth.uid"
        },

        "status": {
          ".write": "root.child('rooms').child($roomCode).child('host').val() == auth.uid"
        },

        "gameState": {
          ".write": "root.child('rooms').child($roomCode).child('status').val() == 'playing'"
        }
      }
    },

    "presence": {
      "$userId": {
        ".read": true,
        ".write": "auth.uid == $userId"
      }
    },

    "globalChat": {
      ".read": true,
      ".write": "auth != null"
    }
  }
}
