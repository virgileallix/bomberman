<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bomberman Multiplayer - Lobby</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/skin-editor.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body class="lobby-page">
    <div class="stars-bg"></div>

    <div class="lobby-container">
        <header class="game-header">
            <h1 class="game-title">üí£ BOMBERMAN</h1>
            <p class="game-subtitle">Multiplayer Arena</p>
        </header>

        <!-- Profile Section -->
        <div class="profile-section">
            <div class="user-info">
                <div class="avatar" id="userAvatar">üë§</div>
                <div class="user-details">
                    <input type="text" id="username" placeholder="Enter your name..." maxlength="12">
                    <div class="user-stats">
                        <span class="rank" id="userRank">Bronze</span>
                        <span class="elo" id="userElo">1000 ELO</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Lobby -->
        <div class="lobby-content">
            <div class="lobby-actions">
                <button class="btn btn-primary" id="createRoomBtn">
                    <span class="btn-icon">üéÆ</span>
                    Create Room
                </button>

                <button class="btn btn-secondary" id="customizeSkinsBtn">
                    <span class="btn-icon">üé®</span>
                    Customize Skins
                </button>

                <div class="join-room-input">
                    <input type="text" id="roomCode" placeholder="Room code..." maxlength="6">
                    <button class="btn btn-secondary" id="joinRoomBtn">
                        <span class="btn-icon">üö™</span>
                        Join
                    </button>
                </div>
            </div>

            <!-- Public Rooms List -->
            <div class="rooms-list">
                <h3 class="section-title">üåê Public Rooms</h3>
                <div id="roomsList" class="rooms-grid">
                    <div class="empty-state">
                        <p>No public rooms available</p>
                        <p class="hint">Create one to start playing!</p>
                    </div>
                </div>
            </div>

            <!-- Global Chat -->
            <div class="chat-section">
                <h3 class="section-title">üí¨ Global Chat</h3>
                <div class="chat-messages" id="globalChat"></div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="Type a message..." maxlength="100">
                    <button class="btn btn-icon" id="sendChatBtn">üì®</button>
                </div>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="leaderboard-section">
            <h3 class="section-title">üèÜ Top Players</h3>
            <div id="leaderboard" class="leaderboard-list"></div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content login-modal">
            <div class="login-header">
                <div class="logo-container">
                    <span class="logo-icon">üí£</span>
                    <h2>BOMBERMAN</h2>
                </div>
                <p class="subtitle">Pr√©parez-vous au combat !</p>
            </div>

            <div class="login-body">
                <!-- Quick Login Section -->
                <div class="quick-login-section">
                    <button class="btn-auth btn-google" id="googleSignInBtn">
                        <span class="auth-icon">üîê</span>
                        <span class="auth-text">Continuer avec Google</span>
                    </button>

                    <button class="btn-auth btn-guest" id="guestSignInBtn">
                        <span class="auth-icon">üë§</span>
                        <span class="auth-text">Jouer en invit√©</span>
                    </button>
                </div>

                <div class="divider-horizontal">
                    <span class="divider-text">OU</span>
                </div>

                <!-- Email Login/Register Section -->
                <div class="email-auth-section">
                    <div id="emailLoginForm" class="auth-form">
                        <div class="form-group">
                            <input type="email" id="loginEmail" placeholder="Votre email" autocomplete="email" class="form-input">
                        </div>
                        <div class="form-group">
                            <input type="password" id="loginPassword" placeholder="Mot de passe" autocomplete="current-password" class="form-input">
                        </div>
                        <button class="btn-submit" id="emailSignInBtn">
                            <span>Se connecter</span>
                            <span class="btn-arrow">‚Üí</span>
                        </button>
                    </div>

                    <div id="emailRegisterForm" class="auth-form hidden">
                        <div class="form-group">
                            <input type="text" id="registerUsername" placeholder="Nom d'utilisateur" maxlength="12" class="form-input">
                        </div>
                        <div class="form-group">
                            <input type="email" id="registerEmail" placeholder="Votre email" autocomplete="email" class="form-input">
                        </div>
                        <div class="form-group">
                            <input type="password" id="registerPassword" placeholder="Mot de passe (min. 6 caract√®res)" autocomplete="new-password" class="form-input">
                        </div>
                        <button class="btn-submit" id="emailRegisterBtn">
                            <span>Cr√©er mon compte</span>
                            <span class="btn-arrow">‚Üí</span>
                        </button>
                    </div>

                    <div class="toggle-auth">
                        <button class="toggle-link" id="toggleAuthMode">
                            <span id="authModeText">Pas encore de compte ? Inscrivez-vous</span>
                        </button>
                    </div>
                </div>

                <div id="authError" class="auth-error hidden"></div>
            </div>
        </div>
    </div>

    <!-- Skin Customization Modal -->
    <div id="skinCustomizationModal" class="modal hidden">
        <div class="modal-content skin-editor-modal">
            <div class="modal-header">
                <h2>üé® Personnalisation des Skins</h2>
                <button class="btn-close" id="closeSkinEditor">‚úï</button>
            </div>

            <div class="skin-editor-container">
                <!-- Tabs -->
                <div class="skin-tabs">
                    <button class="skin-tab active" data-tab="character">
                        <span>üë§</span> Personnage
                    </button>
                    <button class="skin-tab" data-tab="bomb">
                        <span>üí£</span> Bombe
                    </button>
                </div>

                <!-- Character Editor -->
                <div class="skin-editor-content" id="characterEditor">
                    <div class="editor-grid">
                        <!-- Preview -->
                        <div class="editor-preview-section">
                            <h3>Aper√ßu</h3>
                            <div class="preview-container">
                                <canvas id="characterPreviewCanvas" width="128" height="128"></canvas>
                            </div>
                            <div class="preview-info">
                                <p>Taille: 32x32 pixels</p>
                            </div>
                        </div>

                        <!-- Tools -->
                        <div class="editor-tools-section">
                            <h3>Outils</h3>

                            <!-- Premade Skins -->
                            <div class="premade-skins">
                                <h4>Skins Pr√©faits</h4>
                                <div class="premade-grid" id="characterPremadeGrid">
                                    <!-- Will be populated by JS -->
                                </div>
                            </div>

                            <!-- Drawing Tools -->
                            <div class="drawing-tools">
                                <h4>Dessiner</h4>
                                <div class="tool-buttons">
                                    <button class="tool-btn active" data-tool="pencil" title="Crayon">‚úèÔ∏è</button>
                                    <button class="tool-btn" data-tool="eraser" title="Gomme">üßπ</button>
                                    <button class="tool-btn" data-tool="fill" title="Remplir">ü™£</button>
                                    <button class="tool-btn" data-tool="picker" title="Pipette">üíß</button>
                                </div>
                                <div class="color-picker-section">
                                    <label>Couleur:</label>
                                    <input type="color" id="characterColorPicker" value="#00f0ff">
                                    <div class="color-presets" id="characterColorPresets">
                                        <div class="color-preset" style="background: #00f0ff" data-color="#00f0ff"></div>
                                        <div class="color-preset" style="background: #ff00ff" data-color="#ff00ff"></div>
                                        <div class="color-preset" style="background: #ffff00" data-color="#ffff00"></div>
                                        <div class="color-preset" style="background: #00ff88" data-color="#00ff88"></div>
                                        <div class="color-preset" style="background: #ff0055" data-color="#ff0055"></div>
                                        <div class="color-preset" style="background: #ffffff" data-color="#ffffff"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Import/Export -->
                            <div class="import-export">
                                <h4>Importer / Exporter</h4>
                                <label class="file-upload-btn">
                                    üìÅ Importer Image
                                    <input type="file" id="characterImageUpload" accept="image/*" hidden>
                                </label>
                                <button class="btn btn-small" id="characterClearBtn">üóëÔ∏è Effacer</button>
                                <button class="btn btn-small" id="characterExportBtn">üíæ T√©l√©charger</button>
                            </div>
                        </div>

                        <!-- Canvas Editor -->
                        <div class="editor-canvas-section">
                            <h3>√âditeur (32x32)</h3>
                            <div class="canvas-wrapper">
                                <canvas id="characterCanvas" width="32" height="32"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="editor-actions">
                        <button class="btn btn-secondary" id="cancelCharacterSkin">Annuler</button>
                        <button class="btn btn-primary" id="saveCharacterSkin">üíæ Sauvegarder</button>
                    </div>
                </div>

                <!-- Bomb Editor -->
                <div class="skin-editor-content hidden" id="bombEditor">
                    <div class="editor-grid">
                        <!-- Preview -->
                        <div class="editor-preview-section">
                            <h3>Aper√ßu</h3>
                            <div class="preview-container">
                                <canvas id="bombPreviewCanvas" width="128" height="128"></canvas>
                            </div>
                            <div class="preview-info">
                                <p>Taille: 32x32 pixels</p>
                            </div>
                        </div>

                        <!-- Tools -->
                        <div class="editor-tools-section">
                            <h3>Outils</h3>

                            <!-- Premade Skins -->
                            <div class="premade-skins">
                                <h4>Skins Pr√©faits</h4>
                                <div class="premade-grid" id="bombPremadeGrid">
                                    <!-- Will be populated by JS -->
                                </div>
                            </div>

                            <!-- Drawing Tools -->
                            <div class="drawing-tools">
                                <h4>Dessiner</h4>
                                <div class="tool-buttons">
                                    <button class="tool-btn active" data-tool="pencil" title="Crayon">‚úèÔ∏è</button>
                                    <button class="tool-btn" data-tool="eraser" title="Gomme">üßπ</button>
                                    <button class="tool-btn" data-tool="fill" title="Remplir">ü™£</button>
                                    <button class="tool-btn" data-tool="picker" title="Pipette">üíß</button>
                                </div>
                                <div class="color-picker-section">
                                    <label>Couleur:</label>
                                    <input type="color" id="bombColorPicker" value="#000000">
                                    <div class="color-presets" id="bombColorPresets">
                                        <div class="color-preset" style="background: #000000" data-color="#000000"></div>
                                        <div class="color-preset" style="background: #ff0000" data-color="#ff0000"></div>
                                        <div class="color-preset" style="background: #ff6600" data-color="#ff6600"></div>
                                        <div class="color-preset" style="background: #ffcc00" data-color="#ffcc00"></div>
                                        <div class="color-preset" style="background: #808080" data-color="#808080"></div>
                                        <div class="color-preset" style="background: #ffffff" data-color="#ffffff"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Import/Export -->
                            <div class="import-export">
                                <h4>Importer / Exporter</h4>
                                <label class="file-upload-btn">
                                    üìÅ Importer Image
                                    <input type="file" id="bombImageUpload" accept="image/*" hidden>
                                </label>
                                <button class="btn btn-small" id="bombClearBtn">üóëÔ∏è Effacer</button>
                                <button class="btn btn-small" id="bombExportBtn">üíæ T√©l√©charger</button>
                            </div>
                        </div>

                        <!-- Canvas Editor -->
                        <div class="editor-canvas-section">
                            <h3>√âditeur (32x32)</h3>
                            <div class="canvas-wrapper">
                                <canvas id="bombCanvas" width="32" height="32"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="editor-actions">
                        <button class="btn btn-secondary" id="cancelBombSkin">Annuler</button>
                        <button class="btn btn-primary" id="saveBombSkin">üíæ Sauvegarder</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Waiting Room Modal -->
    <div id="waitingRoomModal" class="modal hidden">
        <div class="modal-content waiting-room">
            <div class="room-header">
                <h2>Waiting Room</h2>
                <div class="room-code-display">
                    <span>Code de la room:</span>
                    <code id="displayRoomCode">------</code>
                    <button class="btn-copy" id="copyCodeBtn" title="Copier le lien de la room">üîó</button>
                </div>
                <p class="room-share-hint">Partagez le lien pour inviter vos amis !</p>
            </div>

            <div class="players-grid" id="playersGrid">
                <!-- Player slots will be dynamically added -->
            </div>

            <!-- Skin Customization -->
            <div class="skin-customization">
                <h3>üé® Personnalisation</h3>
                <div class="skin-sections">
                    <div class="skin-section">
                        <h4>Personnage</h4>
                        <div class="skin-preview" id="characterPreview">üßë</div>
                        <div class="skin-selector" id="characterSkinSelector">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    <div class="skin-section">
                        <h4>Bombe</h4>
                        <div class="skin-preview" id="bombPreview">üí£</div>
                        <div class="skin-selector" id="bombSkinSelector">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="room-settings" id="roomSettings">
                <h3>Game Settings</h3>
                <div class="settings-grid">
                    <label>
                        Map
                        <select id="mapSelect">
                            <option value="classic">Classic</option>
                            <option value="maze">Maze</option>
                            <option value="arena">Arena</option>
                        </select>
                    </label>
                    <label>
                        Round Duration
                        <select id="durationSelect">
                            <option value="180">3 minutes</option>
                            <option value="300" selected>5 minutes</option>
                            <option value="480">8 minutes</option>
                        </select>
                    </label>
                    <label>
                        Power-ups
                        <input type="checkbox" id="powerupsToggle" checked>
                    </label>
                </div>
            </div>

            <div class="room-chat">
                <div class="chat-messages" id="roomChat"></div>
                <div class="chat-input">
                    <input type="text" id="roomChatInput" placeholder="Chat with players..." maxlength="100">
                    <button class="btn btn-icon" id="sendRoomChatBtn">üì®</button>
                </div>
            </div>

            <div class="room-actions">
                <button class="btn btn-secondary" id="leaveRoomBtn">Leave</button>
                <button class="btn btn-ready" id="readyBtn">Ready</button>
                <button class="btn btn-primary hidden" id="startGameBtn">Start Game</button>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
        import { getDatabase } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD7cxkTRl1OgFRVzPPf5Us0LRZSZM07u08",
            authDomain: "bomb-16743.firebaseapp.com",
            databaseURL: "https://bomb-16743-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "bomb-16743",
            storageBucket: "bomb-16743.firebasestorage.app",
            messagingSenderId: "866325131307",
            appId: "1:866325131307:web:d4884ecf4b464fee4f3a6e",
            measurementId: "G-B1SR1M0TEK"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);
        const firestore = getFirestore(app);

        // Make available globally
        window.firebaseApp = app;
        window.database = database;
        window.firestore = firestore;
    </script>
    <script type="module" src="js/lobby.js"></script>
</body>
</html>
